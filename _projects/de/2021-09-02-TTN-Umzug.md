---
layout: project_page
title: "senseBox Umzug von TTNv2 auf TTNv3"
date: 2021-09-02
author: Felix
abstract: "Eine Schritt für Schritt Anleitung um deine senseBox von TTNv2 auf TTNv3 umzuziehen"

thumbnail: /images/projects/TTN_Umzug/uebersicht.png

lang: de
tags: []
difficult: leicht
---

<style>
img {
  max-width: 100%;
}
</style>
<head><title>senseBox Umzug von TTNv2 auf TTNv3</title></head>

Das öffentliche The Things Network schaltet Ende 2020 die alte Version (TTNv2) ab und wird daraufhin nur noch die neue Version (TTNv3) betreiben. In diesem Projekt zeigen wir euch wie ihr eine senseBox aus TTNv2 auf TTNv3 umziehen könnt.

### `console.cloud.thethings.network`

Besuche [https://console.cloud.thethings.network/](https://console.cloud.thethings.network/) und du kommst auf die neue Übersichtsseite der TTN Consolen.

![](/images/projects/TTN_Umzug/uebersicht.png)

Öffne hier zunächst die "[Legacy V2 Console](https://v2console.thethingsnetwork.org/)"

### TTNv2 Konsole

Öffne in der TTNv2 Konsole deine "Applications" und wähle die Application aus welche du umziehen möchtest.

![](/images/projects/TTN_Umzug/ttnv2-console.png)

Gehe dort auf den Reiter "Devices" und öffne das Device, welches du auf TTNv3 umziehen möchtest.

![](/images/projects/TTN_Umzug/ttnv2-application.png)

In dem Device sehen wir nun die EUIs welche wir auf TTNv3 übertragen müssen.

![](/images/projects/TTN_Umzug/ttnv2-device.png)

Lasse den Tab geöffnet. Im nächsten Schritt erstellen wir eine neue Application in der neuen TTNv3 Konsole

### TTNv3 Konsole

Öffne die TTNv3 Konsole in einem neuen Tab. Entweder über die [Übersichtsseite](https://console.cloud.thethings.network/) oder direkt: [https://eu1.cloud.thethings.network/](https://eu1.cloud.thethings.network/). Hier kannst du dich mit deinen bisherigen TTN Login Daten unter "Login with The Things ID" einloggen.

![](/images/projects/TTN_Umzug/ttnv3-login.png)

Öffne in der TTNv3 Konsole die "Applications"

![](/images/projects/TTN_Umzug/ttnv3-console.png)

Und erstelle mit dem "+ Add Application" eine neue Application.

![](/images/projects/TTN_Umzug/ttnv3-create-application.png)

Gebe hier die Application ID an. **Kopiere diese aus der TTNv2 Konsole. Achte darauf, dass die Application ID die selbe ist.** Erstelle daraufhin die Application mit dem "Create application" Button.

Erstelle nun ein neues Device über den "+ Add end device" Button.

![](/images/projects/TTN_Umzug/ttnv3-create-device.png)

Wähle auf der nächsten Seite den Reiter "Manually" und wähle `MAC V1.0.2` als "LoRaWAN version". Im "Frequency plan" wählen wir `Europe 863-870 Mhz (SF9 for RX2 - recommended)` aus.

![](/images/projects/TTN_Umzug/ttnv3-register-device.png)

Im unteren Teil müssen wir nun die EUIs aus der TTNv2 Konsole übernehmen. Dazu wechseln wir erneut zur TTNv2 Konsole und kopieren nacheinander die "Device EUI", "Application EUI" und den "App Key" über den Kopieren Button zu TTNv3.

![](/images/projects/TTN_Umzug/ttnv2-copy-euis.png)

![](/images/projects/TTN_Umzug/ttnv3-paste-euis.png)

Zuletzt muss noch die "End device ID" übertragen werden. Kopiere also die "Device ID" aus TTNv2 und kopiere diese in TTNv3.

Registriere nun das neue Device mit dem "Register end device" Button.

### TTNv3 Webhook hinzufügen

Damit die ankommenden Daten zur openSenseMap weitergeleitet werden muss eine Webhook Integration hinzugefügt werden. Öffne dazu auf der linken Seite über die "Integrations" die "Webhooks" und füge eine neue Webhook mit dem "+ Add webhook" Button hinzu.

![](/images/projects/TTN_Umzug/ttnv3-integrations.png)

Wähle im nächsten Schritt eine "Custom webhook"

![](/images/projects/TTN_Umzug/ttnv3-webhook.png)

Und gebe der Webhook eine ID (z.B. `osem`). Für das Webhook format wählen wir `JSON` und nutze `https://ttn.opensensemap.org/v3` als "Base URL".

![](/images/projects/TTN_Umzug/ttnv3-webhook-settings.png)

Auf der unteren Seite müssen noch "Uplink messages" aktiviert werden.

![](/images/projects/TTN_Umzug/ttnv3-webhook-uplink.png)

Nun können wir die Webhook über "Add webhook" speichern.

### (Optional) TTNv3 Payload formatter anpassen

**Mit dem normalen Code der senseBox:home, welcher über die openSenseMap generiert wird, kann dieser Schritt übersprungen werden.**

Gegebenenfalls müssen wir bei der Application noch den Payload formatter anpassen, je nachdem in welchem Format die Daten gesendet werden. Dazu auf der linken Seite auf "Payload formatters" -> "Uplink" den entsprechenden Formatter auswählen. Wenn die Daten als Cayenne LPP verschickt werden muss hier `CayenneLPP` ausgewählt werden. Eigene Payload formatter können über `Javascript` eingefügt werden.

### TTNv2 Application löschen

Nun kann die alte TTNv2 Application gelöscht werden. Dazu in den Settings der Application unten auf "Delete application ..." klicken.

![](/images/projects/TTN_Umzug/ttnv2-delete-application.png)

### senseBox neu starten

Zuletzt müssen wir die senseBox neu starten (kurz vom Strom nehmen) und nun sollte sie sich direkt mit dem neuen TTNv3 verbinden und die Daten an die openSenseMap weiterleiten.
