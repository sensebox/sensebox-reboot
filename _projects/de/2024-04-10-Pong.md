---
layout: project_page
date: 2024-04-10
author: Paula
title: "Spiele Pong"
abstract: "Nutze den Beschleunigungssensor und ESP-Now um Pong allein oder zu zweit zu spielen."
thumbnail: /images/projects/Titelbild_Emoji.png
image0: /images/projects/Pong/0.png
image1: /images/projects/Pong/only_players_draw_init.png
image2: /images/projects/Emoji/only_players_draw.png
image3: /images/projects/Emoji/only_players_move_sensor_A.png
image4: /images/projects/Emoji/only_players.png
image5: /images/projects/Emoji/ball_movement_variables.png
image6: /images/projects/Emoji/ball_movement_draw_cropped.png
image7: /images/projects/Emoji/ball_movement.png
image8: /images/projects/Emoji/collision_top_bottom.png
image9: /images/projects/Emoji/collision_left_player.png
image10: /images/projects/Emoji/collision_players.png
image11: /images/projects/Emoji/collision_out.png

material:
  - 1-2x senseBox MCU S2
  - 1x LED-Matrix
  - 1x QWIIC-Kabel
ide: blockly
version: ["edu-S2"]
lang: de
tags: ["Informatik","Spiel"]
difficult: schwer
---

... abstract ...

## Aufbau

Verbinde die LED-Matrix mit einem QWIIC-Kabel und schließe sie an Port A der GPIO-Schnittstelle an. Wenn der du alleine spielen möchtest ist das alles was du brauchst. 

{% include image.html image=page.image0 %}

Falls du zu zweit spielen möchtest benötigst du noch eine zweite senseBox MCU S2.

## Programmierung

### Zeichnen der Spieler

Initialisiere als erstes die LED-Matrix im Setup() und erstelle zwei Variabeln. Diese Variabeln werden die Position der Spieler speichern. Du kannst sie als Zahl (int) oder auch als Kommazahl (float) definieren. Falls du später noch ein wenig mit den Positionen und Bewegungen der Spieler experimentieren möchtest (siehe XXX) ist es sinnvoll sie als Kommazahlen zu definieren.

{% include image.html image=page.image1 %}

Erstelle als nächstes eine neue Funktion (hier "draw" benannt). In dieser Funktion werden die Spieler (und später auch der Ball) gezeichnet. Füge zuerst vier mal den Block __Pixel setzen__ in die neue Funktion ein. Der Spieler soll in der Spalte 0 (gamz links) der LED-Matrix gezeichnet werden, weshalb die X-Koordinaten aller vier Blöcke auf 0 gesetzt werden. Die Y-Koordinate wird für das erste Pixel auf den Wert der Positionsvariable des jeweiligen Spielers gesetzt. Nachfolgende Pixel werden jeweils ein Feld weiter unten gezeichnet. Unser Spieler ist damit 4 Pixel hoch. Wähle eine Farbe deiner Wahl für den Spieler. 

Für den zweiten Spieler fügst du nun vier weitere __Pixel setzen__ Blöcke ein. Der Spieler soll sich auf der äußerst rechten Spalte des Spielfelds befinden, setze also für diese vier Blöcke auf die X Position 11. 

Nachdem du beide Spieler hiermit gezeichnet hast entferne an allen Blöcken *außer dem Letzten* das Häkchen an "Zeige sofort". Wenn du dies nicht tust flackert die LED-Matrix, da nach jedem Färben eines Pixels die ganze Matrix neu angezeigt wird.

Rufe anschließend die kreierte Funktion im Setup() auf.

{% include image.html image=page.image2 %}

### Steuern der Spieler

Um einen Spieler zu Bewegen verwenden wir den eingebauten Beschleunigungssensor. Wir nutzen dafür Logikblöcke um abzufragen, ob der Sensor aktuell entlang der X-Achse in eine Richtung geneigt ist. Misst der Sensor für X Werte unter -1 ist die senseBox eindeutig in eine Richtung geneigt; misst er mehr als positiv 1 ist sie eindeutig in die andere Richtung geneigt. Alles zwischen 1 und -1 interprieren wir als nicht geneigt und in diesem Fall wird der Spieler nicht bewegt. Ist die senseBox also eindeutig geneigt erhöhen oder erniedrigen wir die Position eines Spielers um jeweils ein Pixel. Der Spieler sollte sich jedoch nicht aus der LED-Matrix heraus bewegen können. Aus diesem Grund beschränken wir die Position des Spielers zwischen 1 und 5. Alles in allem ergibt sich folgender Code:

{% include image.html image=page.image3 %}

Nachdem wir die Position des Spielers angepasst haben zeichnen wir ihn neu, mit der zuvor definierten Funktion. Packe nun die beiden Logik Blöcke und den Funktionsaufruf in einen __Intervall__ Block damit sich der Spieler nicht zu schnell bewegen kann. Stelle als Zeit 100ms ein und füge nun alles in den Loop().

**WICHTIG**: Da sich die Position des Spielers nun ändern kann füge einen Block __Matrix leeren__ zu Beginn deiner Funktion zum Zeichen (hier "draw" benannt) ein, damit die alte Position des Spielers nicht mehr zu sehen ist.

Nun sollte dein gesamter Code wie folgt aussehen:

{% include image.html image=page.image4 %}

### Ball zeichnen und bewegen

Definiere als erstes Variabeln für den Ball, die seine Position und Bewegungsrichtung sowohl horizontal als auch vertikal definieren. In unserem Beispiel setzen wir die horizontale und vertikale Richtung auf -1, das heißt, der Ball wird sich zu Beginn nach schräg links oben bewegen.

{% include image.html image=page.image5 %}

Füge nun einen neuen Block __Pixel setzen__ am Ende der Funktion zum Zeichnen ein (hier "draw" benannt) um den Ball abhängig von der aktuellen horizontalen (hier "ball_x") und vertikalen Position (hier "ball_y") zu zeichnen. Danke daran, dass nur der letzte __Pixel setzen__ Block ein Häkchen an "Zeige sofort" benötigt.

{% include image.html image=page.image6 %}

Als nächstes ändern wir die Position des Balles alle 200 Millisekunden um die jeweiligen aktuellen Bewegungsrichtungen. Dafür erstellen wir ein neues Intervall in der Endlosschleife() und addieren darin die horizontale Richtung auf die horizontale Position und die vertikale Richtung auf die vertikale Position. Rufe danach die Funktion zum Zeichnen auf um die neue Position des Balles auf der LED-Matrix anzuzeigen. Beachte, dass das Intervall einen anderen Namen als das Intervall zur Bewegung der Spieler haben sollte.
Dein Code sollte nun wiefolgt aussehen:

{% include image.html image=page.image7 %}

### Kollisionsprüfung

Sowohl an der oberen und unteren Kante der LED-Matrix als auch an den beiden Spieler soll der Ball "abprallen". Dafür werden wir eine Funktion erstellen die überprüft, ob der Ball momentan mit einer Kante oder einem Spieler kollidiert und gegebenenfalls die Richtung des Balles ändern.

Als erstes werden wir uns um Kollisionen mit der oberen und unteren Kante kümmern. Erstelle also zu Beginn einen neue Funktion (hier nennen wir sie "check_position"). Mache nun eine Abfrage in der Funktion, ob die vertikale Position des Balles größer oder gleich 0 oder kleiner oder gleich 7 ist. Diese Abfrage wird zutreffen sobald der Ball sich am äußersten Rand oder außerhalb des Bildschirms befindet. In diesem Fall muss dann die vertikale Richtung des Balles umgedreht werden, um ihn vom Rand abprallen zu lassen.

{% include image.html image=page.image8 %}

Als nächstes kümmern wir uns um die Überprüfung, ob der Ball mit einem Spieler kollidiert und an ihm abprallt. Wir beginnen mit der Überprüfung des linken Spielers. Erstelle dazu als erstes eine neue Logik Abfrage, ob die horizontale Position des Spielers auf der äußerst linken Spalte des Spielfeldes befindet, also zwischen 1 und 0 liegt. Ist dies der Fall überprüfe nun, ob sich die vertikale Position des Balles auf dem linken Spieler befindet. Da der Spieler vier Pixel groß ist, müssen wir dafür überprüfen, ob die vertikale Position kleiner oder gleich der Position des Spielers **plus 3** ist oder größer oder gleich der Position des Spielers (ohne plus) ist. Ist auch dies der Fall kehren wir die horizontale Bewegungsrichtung des Balles um.

{% include image.html image=page.image9 %}

Die Überprüfung auf Kollision mit dem rechten Spieler funktioniert fast genauso, nur dass wir zuerst überprüfen, ob die horizontale Position des Balles zwischen 10 und 11 liegt und danach die vertikale Position nicht mit dem lenken sondern mit dem rechten Spieler abgleichen.

Packe die beiden Überprüfungen nun jeweils in eine Kammer eines __wenn mache sonst__ Blockes. Mit diesem Block soll sichergestellt werden, dass der Ball vom linken Spieler nur nach rechts abprallen kann und vom rechten Spieler nur nach links. Dafür überprüfen wir, ob die aktuelle Bewegungsrichtung des Balles größer (nach rechts) oder kleiner als 0 ist (nach links). Tun wir dies nicht, kann es sein, dass der Ball hinter oder in einem Spieler stecken bleibt.

Zu diesem Zeitpunkt sollte deine Funktion nun wie folgt aussehen:

{% include image.html image=page.image10 %}

Nun können wir noch überprüfen, ob sich der Ball am rechten oder linken Ball aus dem Spielfeld bewegt hat.

{% include image.html image=page.image11 %} 

### Drahtlose Steuerung des zweiten Spielers

...
mac-Addresse
Sende sketch
Empfänger sketch
...

{% include image.html image=page.image3 %} 

### Zusammenfassung

### Ausblick
